function onBackKeyDown(e) { console.log("Processing back request from " + e); loadPage(e, "back button"); $(".header-refresh").animateRotate(360, 1e3, "linear") } function onDeviceReady() { if (parseFloat(window.device.version) === 7) { $("#wrapper-header").css("padding-top", "20px"); $("#content-container").css("padding-top", "3.5em") } document.addEventListener("backbutton", onBackKeyDown, false) } function onResume() { setTimeout(function () { var e = $(".header-refresh").attr("href"); loadPage(e, "resume") }, 0) } function createDate() { function i(e) { return e < 1e3 ? e + 1900 : e } function i(e) { return e < 1e3 ? e + 1900 : e } var e = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"); var t = new Array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"); var n = new Date; var r = (n.getDate() < 10 ? "0" : "") + n.getDate(); var s = new Date((new Date).getTime() + 24 * 60 * 60 * 1e3); var o = (s.getDate() < 10 ? "0" : "") + s.getDate(); var u = e[n.getDay()]; window.today = t[n.getMonth()] + " " + r + ", " + i(n.getYear()); window.tomorrow = t[s.getMonth()] + " " + o + ", " + i(s.getYear()) } function error(e, t) { switch (e) { case "today": $("#timetable-today-loader").load("./core/styling/templates/timetable-ui.html #error-today", function () { $(".error-message-today").html(t); $(".error-message-today").append("<span>Please refer to the school's website for the most up to date information.</span>") }); break; case "tomorrow": $("#timetable-tomorrow-loader").load("./core/styling/templates/timetable-ui.html #error-tomorrow", function () { $(".error-message-tomorrow").html(t); $(".error-message-tomorrow").append("<span>Please refer to the school's website for the most up to date information.</span>") }); break } } function loadPage(e, t) { $(".content-element").hide(); $("title").html(e); $("." + e).removeAttr("style"); $(".header-refresh").attr("href", e); routePage(e) } function routePage(e) { pageList[e]() } function loadTimeTable(e, t, n) { $("#timetable-" + n + "-loader").load("./core/styling/templates/timetable-ui.html #" + e, function () { if (!(e === "none")) { if (t === "1" || t === "2" || t === "3") { var r = "1"; switch (t) { case "1": var s = new Array(1, 2, 3, 4); break; case "2": var s = new Array(2, 3, 1, 4); break; case "3": var s = new Array(3, 1, 2, 4); break } } else { var r = "2"; switch (t) { case "5": var s = new Array(5, 6, 7, 8); break; case "6": var s = new Array(6, 7, 5, 8); break; case "7": var s = new Array(7, 5, 6, 8); break } } var o = 1; for (i in s) { $(this).find("#timetable" + o).html(s[i]); o++ } $(this).find(".schedule-header-day").html("Day " + r) } else { error(n, "No school scheduled for " + n) } if (n === "today") { $(this).find(".schedule-header-title").html("Today's Schedule") } else if (n === "tomorrow") { $(this).find(".schedule-header-title").html("Tomorrow's Schedule") } else { error("header-title", "No 'time' variable specified.") } }) } function displayListItem(e, t) { switch (e) { case "admin": $(".admin-list-data").append("<li> <span class='font-light item-title'>" + t.title + "</span><span class='item-name font-light'> " + t.name + "</span><div class='item-link-container'><a href='mailto:" + t.email + "' class='item-email font-light'>Email: " + t.email + "</a> </div></li>"); break; case "teachers": var n = _.isUndefined(t.website); if (!n) { $(".teachers-list-data").append("<li><span class='font-light item-name'>" + t.name + "</span><div class='item-link-container'><a href='mailto:" + t.email + "' class='font-light item-email'>Email: " + t.email + "</a><br /><a class='font-light item-web' href='" + t.website + "'>Visit their website</a></div></li>") } else { $(".teachers-list-data").append("<li><span class='item-name font-light'>" + t.name + "</span><div class='item-link-container'><a href='mailto:" + t.email + "' class='font-light item-email'> Email: " + t.email + "</a></div></li>") } break; case "support": var r = _.isUndefined(t.website); if (!r) { $(".support-list-data").append("<li> <span class='item-title font-light'>" + t.title + "</span><br /> <span class='item-name font-light'>" + t.name + "</span><div class='item-link-container'><a href='mailto:" + t.email + "' class='item-email font-light'>Email: " + t.email + "</a><br /><a class='item-web font-light' href='" + t.website + "'>Visit their website</a></div></li>") } else { $(".support-list-data").append("<li> <span class='item-title font-light'>" + t.title + "</span><br /> <span class='item-name font-light'>" + t.name + "</span><div class='item-link-container'><a href='mailto:" + t.email + "' class='item-email font-light'>Email: " + t.email + "</a></div></li>") } break; case "academics": $(".academics-list-data").append("<li><a class='font-light item-program item-web' href='" + t.website + "'>" + t.name + "</a></li>"); break; case "athletics": $(".athletics-list-data").append("<li><a class='font-light item-program item-web' href='" + t.website + "'>" + t.name + "</a></li>"); break; case "arts": $(".arts-list-data").append("<li><a class='font-light item-program item-web' href='" + t.website + "'>" + t.name + "</a></li>"); break; case "workexperience": $(".workexperience-list-data").append("<li><a class='font-light item-program item-web' href='" + t.website + "'>" + t.name + "</a></li>"); break } } document.addEventListener("deviceready", onDeviceReady, false); var trigger = "touchstart"; document.addEventListener("resume", onResume, false); window.today; window.tomorrow; createDate(); console.log(window.today); if (window.today === "February 26, 2014") { $("<link/>", { rel: "stylesheet", type: "text/css", href: "./core/styling/css/psd.css" }).appendTo("head") } $.fn.animateRotate = function (e, t, n, r) { var i = $.speed(t, n, r); var s = i.step; return this.each(function (t, n) { i.step = function (e) { $.style(n, "-webkit-transform", "rotate(" + e + "deg)"); if (s) return s.apply(this, arguments) }; $({ deg: 0 }).animate({ deg: e }, i) }) }; $(".header-refresh").bind("click", function (e) { e.preventDefault(); e.returnValue = false }); $(".header-refresh").bind(trigger, function (e) { var t = $(this).attr("href"); loadPage(t, "refresh button"); $(".header-refresh").animateRotate(360, 1e3, "linear"); e.preventDefault() }); $(".header-back").bind("click", function (e) { e.preventDefault(); e.returnValue = false }); $(".header-back").bind(trigger, function (e) { var t = $(this).attr("href"); onBackKeyDown(t); e.preventDefault() }); $(".staff-list ul").on("click", "li", function (e) { var t = $(this).find(".item-link-container"); var n = $(t).is(":visible"); if (n) { $(this).find(".item-link-container").hide(); $(".item-link-container").hide() } else { $(".item-link-container").hide(); $(this).find(".item-link-container").show() } }); $(".web-data").on("click", ".item-web", function (e) { var t = $(this).attr("href"); var n = window.open(t, "_system", "location=yes"); e.preventDefault(); e.returnValue = false }); $(".nav").bind("click", function (e) { e.returnValue = false; e.preventDefault() }); $(".nav").bind(trigger, function (e) { var t = $(this).attr("href"); loadPage(t, "nav"); e.returnValue = false; e.preventDefault() }); var pageList = { rotationWeek: function () { window.scrollTo(0, 0); $(".header-back").attr("href", "rotation"); $(".header-back").show(); $(".rotationWeek-console").html("It's alive!") }, rotation: function () { window.scrollTo(0, 0); createDate(); $.getJSON("./core/logic/db/rotation.json", function (e) { for (var t in e.rotations) { if (e.rotations[t].date === window.today) { var n = e.rotations[t]; loadTimeTable(n.structure, n.order, "today") } if (e.rotations[t].date === window.tomorrow) { var r = e.rotations[t]; loadTimeTable(r.structure, r.order, "tomorrow") } } var i = _.isUndefined(n); var s = _.isUndefined(r); if (i) { error("today", "Today's schedule could not be loaded") } if (s) { error("tomorrow", "Tomorrow's schedule could not be loaded") } }) }, staff: function () { $(".list-data").html(""); $.getJSON("./core/logic/db/staff.json", function (e) { for (var t in e.admin) { var n = e.admin[t]; displayListItem("admin", n) } for (var r in e.teachers) { var n = e.teachers[r]; displayListItem("teachers", n) } for (var i in e.support) { var n = e.support[i]; displayListItem("support", n) } }) }, sites: function () { $(".list-data").html(""); $.getJSON("./core/logic/db/sites.json", function (e) { for (var t in e.academics) { var n = e.academics[t]; displayListItem("academics", n) } for (var r in e.athletics) { var n = e.athletics[r]; displayListItem("athletics", n) } for (var i in e.arts) { var n = e.arts[i]; displayListItem("arts", n) } for (var s in e.workexperience) { var n = e.workexperience[s]; displayListItem("workexperience", n) } }) }, about: function () { window.scrollTo(0, 0); $.getJSON("./core/logic/db/about.json", function (e) { $(".current-version").html(e.version) }) } }; loadPage("rotation", "startup"); app.initialize()